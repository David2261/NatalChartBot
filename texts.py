
def deg_to_sign(deg):
	"""–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≥—Ä–∞–¥—É—Å—ã (0‚Äì360) –≤ –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞ –∏ –≥—Ä–∞–¥—É—Å—ã –≤ –∑–Ω–∞–∫–µ"""
	signs = [
		"–û–≤–Ω–∞", "–¢–µ–ª—å—Ü–∞", "–ë–ª–∏–∑–Ω–µ—Ü–æ–≤", "–†–∞–∫–∞", "–õ—å–≤–∞", "–î–µ–≤—ã",
		"–í–µ—Å–æ–≤", "–°–∫–æ—Ä–ø–∏–æ–Ω–∞", "–°—Ç—Ä–µ–ª—å—Ü–∞", "–ö–æ–∑–µ—Ä–æ–≥–∞", "–í–æ–¥–æ–ª–µ—è", "–†—ã–±"
	]
	sign_index = int(deg // 30)
	degrees_in_sign = deg % 30
	minutes = int((degrees_in_sign % 1) * 60)
	return f"{int(degrees_in_sign)}¬∞{minutes:02d}' {signs[sign_index]}"


def get_house(cusps, planet_deg):
	"""–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –≤ –∫–∞–∫–æ–º –¥–æ–º–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–ª–∞–Ω–µ—Ç–∞ (–ø–æ –∫—É—Å–ø–∏–¥–∞–º –¥–æ–º–æ–≤)"""
	for i in range(12):
		cusp_start = cusps[i]
		cusp_end = cusps[(i + 1) % 12]
		if cusp_start <= planet_deg < cusp_end or \
		   (cusp_start > cusp_end and (planet_deg >= cusp_start or planet_deg < cusp_end)):
			return i + 1
	return 1  # –Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–æ–∫


def generate_free_interpretation(chart):
	"""–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è ‚Äî —Ç–æ–ª—å–∫–æ –°–æ–ª–Ω—Ü–µ, –õ—É–Ω–∞, –ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç + –æ–¥–∏–Ω –∞—Å–ø–µ–∫—Ç + —Ç–∏–∑–µ—Ä"""
	pos = chart['positions']
	asc = chart['asc']
	aspects = chart.get('aspects', [])

	sun_sign = deg_to_sign(pos['Sun'])
	moon_sign = deg_to_sign(pos['Moon'])
	asc_sign = deg_to_sign(asc)

	text = "<b>–ö—Ä–∞—Ç–∫–∏–π –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–∞—à–µ–π –Ω–∞—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã</b>\n\n"

	text += f"üåû <b>–°–æ–ª–Ω—Ü–µ –≤ {sun_sign}</b>\n"
	text += "–í–∞—à–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –∏ –∂–∏–∑–Ω–µ–Ω–Ω–∞—è —Å—É—Ç—å —Å–≤—è–∑–∞–Ω—ã —Å –∫–∞—á–µ—Å—Ç–≤–∞–º–∏ —ç—Ç–æ–≥–æ –∑–Ω–∞–∫–∞. "
	text += "–í—ã —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –ø—Ä–æ—è–≤–ª—è—Ç—å —Å–µ–±—è —è—Ä–∫–æ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ.\n\n"

	text += f"üåô <b>–õ—É–Ω–∞ –≤ {moon_sign}</b>\n"
	text += "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–∏—Ä–æ–¥–∞, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Ç–æ, "
	text += "–∫–∞–∫ –≤—ã –∑–∞–±–æ—Ç–∏—Ç–µ—Å—å –æ —Å–µ–±–µ –∏ –±–ª–∏–∑–∫–∏—Ö.\n\n"

	text += f"‚Üë <b>–ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç –≤ {asc_sign}</b>\n"
	text += "–ü–µ—Ä–≤–æ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ –Ω–∞ –ª—é–¥–µ–π, "
	text += "–≤–∞—à –≤–Ω–µ—à–Ω–∏–π —Å—Ç–∏–ª—å –∏ –ø–æ–¥—Ö–æ–¥ –∫ –Ω–æ–≤—ã–º —Å–∏—Ç—É–∞—Ü–∏—è–º.\n\n"

	# –û–¥–∏–Ω —Å–∞–º—ã–π —Ç–æ—á–Ω—ã–π –∞—Å–ø–µ–∫—Ç (—Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –æ—Ä–±–∏—Å–æ–º)
	if aspects:
		best_aspect = min(aspects, key=lambda a: a['orb'])
		p1, p2 = best_aspect['p1'], best_aspect['p2']
		asp_type = {
			'conj': '—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ', 'opp': '–æ–ø–ø–æ–∑–∏—Ü–∏—è', 'trine': '—Ç—Ä–∏–Ω',
			'square': '–∫–≤–∞–¥—Ä–∞—Ç—É—Ä–∞', 'sextile': '—Å–µ–∫—Å—Ç–∏–ª—å'
		}.get(best_aspect['type'], best_aspect['type'])

		text += f"<b>–í–∞–∂–Ω—ã–π –∞—Å–ø–µ–∫—Ç:</b> {p1} {asp_type} {p2} (–æ—Ä–± {best_aspect['orb']:.1f}¬∞)\n"
		text += "–≠—Ç–æ—Ç –∞—Å–ø–µ–∫—Ç –∑–∞–º–µ—Ç–Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–∞—à —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è.\n\n"

	text += "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n"
	text += "<i>–≠—Ç–æ —Ç–æ–ª—å–∫–æ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã–π –≤–∑–≥–ª—è–¥.</i>\n"
	text += "–í –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:\n"
	text += "‚Ä¢ –ü–æ–ª–æ–∂–µ–Ω–∏–µ –≤—Å–µ—Ö 10 –ø–ª–∞–Ω–µ—Ç\n"
	text += "‚Ä¢ –ü–ª–∞–Ω–µ—Ç—ã –≤ –¥–æ–º–∞—Ö –∏ –∫—É—Å–ø–∏–¥—ã –¥–æ–º–æ–≤\n"
	text += "‚Ä¢ 6‚Äì8 –∫–ª—é—á–µ–≤—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤\n"
	text += "‚Ä¢ –ë–ª–æ–∫–∏: –û—Ç–Ω–æ—à–µ–Ω–∏—è ‚Ä¢ –§–∏–Ω–∞–Ω—Å—ã –∏ –∫–∞—Ä—å–µ—Ä–∞ ‚Ä¢ –ö–∞—Ä–º–∏—á–µ—Å–∫–∏–µ —Ç–µ–º—ã\n"
	text += "‚Ä¢ –ì–ª–∞–≤–Ω–∞—è –∂–∏–∑–Ω–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞\n\n"
	text += "<b>–•–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å –≤—Å—ë?</b> –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"

	return text


def generate_paid_interpretation(chart):
	"""–ü–æ–ª–Ω–∞—è –ø–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä"""
	pos = chart['positions']
	asc = chart['asc']
	mc = chart['mc']
	cusps = chart['cusps']
	aspects = chart.get('aspects', [])

	text = "<b>–ü–æ–ª–Ω—ã–π –Ω–∞—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä</b>\n\n"

	# –ü–ª–∞–Ω–µ—Ç—ã –≤ –∑–Ω–∞–∫–∞—Ö
	text += "<b>–ü–ª–∞–Ω–µ—Ç—ã –≤ –∑–Ω–∞–∫–∞—Ö</b>\n"
	order = ['Sun', 'Moon', 'Mercury', 'Venus', 'Mars', 'Jupiter',
			 'Saturn', 'Uranus', 'Neptune', 'Pluto']
	for planet in order:
		if planet in pos:
			text += f"{planet}: {deg_to_sign(pos[planet])}\n"
	text += "\n"

	# –ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç –∏ MC
	text += f"<b>–ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç</b>: {deg_to_sign(asc)}\n"
	text += f"<b>–°–µ—Ä–µ–¥–∏–Ω–∞ –ù–µ–±–∞ (MC)</b>: {deg_to_sign(mc)}\n\n"

	# –ö—Ä–∞—Ç–∫–æ –∞—Å–ø–µ–∫—Ç—ã
	if aspects:
		text += "<b>–ö–ª—é—á–µ–≤—ã–µ –∞—Å–ø–µ–∫—Ç—ã</b>\n"
		for asp in aspects[:7]:  # –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ 7 —Å–∞–º—ã—Ö —Ç–æ—á–Ω—ã—Ö
			p1, p2 = asp['p1'], asp['p2']
			asp_type_ru = {
				'conj': '‚òå —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ', 'opp': '‚òç –æ–ø–ø–æ–∑–∏—Ü–∏—è', 'trine': '‚ñ≥ —Ç—Ä–∏–Ω',
				'square': '‚ñ° –∫–≤–∞–¥—Ä–∞—Ç—É—Ä–∞', 'sextile': '‚öπ —Å–µ–∫—Å—Ç–∏–ª—å'
			}.get(asp['type'], asp['type'])
			text += f"{p1} {asp_type_ru} {p2}  (–æ—Ä–± {asp['orb']:.1f}¬∞)\n"
		text += "\n"

	# –ë–ª–æ–∫–∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–π (–∑–∞–≥–æ—Ç–æ–≤–∫–∏ ‚Äî –º–æ–∂–Ω–æ –ø–æ—Ç–æ–º –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ò–ò)
	text += "<b>–û—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–æ</b>\n"
	text += "–í–∞—à–∞ –í–µ–Ω–µ—Ä–∞ –∏ 7-–π –¥–æ–º –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, –∫–∞–∫–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –≤—ã –∏—â–µ—Ç–µ –≤ –ø–∞—Ä—Ç–Ω—ë—Ä–µ. "
	text += "–ê—Å–ø–µ–∫—Ç—ã –∫ –í–µ–Ω–µ—Ä–µ –∏ –õ—É–Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–æ–Ω. "
	text += "–°–µ–π—á–∞—Å –≤–∞–∂–Ω–æ —É—á–∏—Ç—å—Å—è –±–∞–ª–∞–Ω—Å—É –º–µ–∂–¥—É ¬´—Ö–æ—á—É¬ª –∏ ¬´–º–æ–≥—É –¥–∞—Ç—å¬ª.\n\n"

	text += "<b>–î–µ–Ω—å–≥–∏, —Ü–µ–Ω–Ω–æ—Å—Ç–∏, —Å–∞–º–æ—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è</b>\n"
	text += f"2-–π –∏ 10-–π –¥–æ–º–∞ + –ø–æ–ª–æ–∂–µ–Ω–∏–µ –Æ–ø–∏—Ç–µ—Ä–∞ –∏ –°–∞—Ç—É—Ä–Ω–∞ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –≤–∞—à —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å—Ç–∏–ª—å –∏ –∫–∞—Ä—å–µ—Ä–Ω—ã–π –ø—É—Ç—å. "
	text += "–í—ã –º–æ–∂–µ—Ç–µ –¥–æ—Å—Ç–∏–≥–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ —É–ø–æ—Ä—Å—Ç–≤–æ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è.\n\n"

	text += "<b>–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ / –∫–∞—Ä–º–∞</b>\n"
	text += "–ê—Å–ø–µ–∫—Ç—ã –∫ –°–∞—Ç—É—Ä–Ω—É, –õ—É–Ω–Ω—ã–º —É–∑–ª–∞–º –∏ –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≥–æ–≤–æ—Ä—è—Ç –æ –≥–ª–∞–≤–Ω—ã—Ö —É—Ä–æ–∫–∞—Ö. "
	text += "–ß–∞—Å—Ç–æ —ç—Ç–æ —Ç–µ–º—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, –≥—Ä–∞–Ω–∏—Ü –∏ –ø—Ä–∏–Ω—è—Ç–∏—è —Å–µ–±—è.\n\n"

	text += "<b>–ì–ª–∞–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ –∂–∏–∑–Ω–∏ / –º–∏—Å—Å–∏—è</b>\n"
	text += "–°–æ–ª–Ω—Ü–µ + –°–µ–≤–µ—Ä–Ω—ã–π —É–∑–µ–ª + —Å–∏–ª—å–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã –∫ Asc/MC –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞—é—Ç –≤–∞—à –ø—É—Ç—å. "
	text += "–°–µ–π—á–∞—Å –∞–∫—Ü–µ–Ω—Ç –Ω–∞ —Ä–∞–∑–≤–∏—Ç–∏–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, —Ç–≤–æ—Ä—á–µ—Å–∫–æ–≥–æ —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏ —É–º–µ–Ω–∏—è –±—ã—Ç—å –≤–∏–¥–∏–º—ã–º.\n\n"

	text += "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n"
	text += "<i>–≠—Ç–æ –æ–±—â–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∞–≤–∏–ª.</i>\n"
	text += "–î–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≥–ª—É–±–æ–∫–æ–≥–æ —Ä–∞–∑–±–æ—Ä–∞ —Å —É—á—ë—Ç–æ–º —Ç—Ä–∞–Ω–∑–∏—Ç–æ–≤ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–π ‚Äî –ø–∏—à–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."

	return text